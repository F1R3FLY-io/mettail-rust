# Build configuration for faster dev builds.
#
# Uses two optimizations:
#   1. Fast linker (mold on Linux, lld on macOS) — speeds up binary/test linking
#   2. Cranelift codegen backend — replaces LLVM codegen (~59s savings) with a
#      faster alternative. Trade-off: debug binaries may run slightly slower.
#
# Prerequisites:
#   Linux: mold linker (https://github.com/rui314/mold)
#     Install: sudo pacman -S mold        (Arch)
#              sudo apt install mold       (Debian/Ubuntu)
#              sudo dnf install mold       (Fedora)
#   macOS: lld linker via LLVM (https://lld.llvm.org/)
#     Install: brew install llvm
#     Ensure llvm bin is in PATH:
#       Apple Silicon: export PATH="/opt/homebrew/opt/llvm/bin:$PATH"
#       Intel Mac:     export PATH="/usr/local/opt/llvm/bin:$PATH"
#   All platforms: nightly toolchain with cranelift (auto-installed via rust-toolchain.toml)
#
# For release builds where LLVM optimization matters, override with:
#   RUSTFLAGS="" cargo build --release
#
# If mold/lld is not installed, comment out the linker and link-arg lines
# for your platform and build with just cranelift:
#   rustflags = ["-Zcodegen-backend=cranelift"]

# --- Linux x86_64 ---
[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=mold", "-Zcodegen-backend=cranelift"]

# --- macOS Apple Silicon ---
[target.aarch64-apple-darwin]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld", "-Zcodegen-backend=cranelift"]

# --- macOS Intel ---
[target.x86_64-apple-darwin]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld", "-Zcodegen-backend=cranelift"]
